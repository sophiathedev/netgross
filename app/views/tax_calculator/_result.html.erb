<div id="calculation_result">
<% if @result %>
  <div class="bg-green-50 border border-green-200 rounded-xl p-6 space-y-4 turbo-update">
    <span style="display:none" data-timestamp="<%= Time.current.to_f %>"></span>
    <div class="flex justify-between items-center py-2 border-b border-green-200">
      <span class="font-medium text-gray-700">Thu nhập gộp (Gross):</span>
      <span class="font-semibold text-lg text-green-700"><%= number_to_currency(@gross_amount, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
    </div>

    <div class="space-y-2">
      <h4 class="font-medium text-gray-700 text-sm">Các khoản bảo hiểm:</h4>
      <div class="pl-4 space-y-1 text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">- BHXH (8%):</span>
          <span class="text-red-600">-<%= number_to_currency(@result.social_insurance_amount, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">- BHYT (1.5%):</span>
          <span class="text-red-600">-<%= number_to_currency(@result.health_insurance_amount, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">- BHTN (1%):</span>
          <span class="text-red-600">-<%= number_to_currency(@result.unemployment_insurance_amount, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
        </div>
      </div>
    </div>

    <div class="flex justify-between items-center py-2 border-b border-green-200">
      <span class="font-medium text-gray-700">Thu nhập trước thuế:</span>
      <span class="font-semibold text-blue-700"><%= number_to_currency(@result.before_tax_amount, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
    </div>

    <div class="space-y-2">
      <h4 class="font-medium text-gray-700 text-sm">Giảm trừ gia cảnh:</h4>
      <div class="pl-4 space-y-1 text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">- Bản thân:</span>
          <span class="text-red-600">-<%= number_to_currency(11_000_000, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">- Người phụ thuộc (<%= @dependent_count %> người):</span>
          <span class="text-red-600">-<%= number_to_currency(@dependent_count * 4_400_000, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
        </div>
      </div>
    </div>

    <div class="space-y-2">
      <h4 class="font-medium text-gray-700 text-sm">Chi tiết thuế thu nhập:</h4>
      <div class="pl-4 space-y-1 text-xs">
        <% total_tax = 0 %>
        <% @result.personal_income_tax_details.each do |range, tax| %>
          <% total_tax += tax %>
          <% if tax > 0 %>
            <div class="flex justify-between">
              <span class="text-gray-600">
                <%= number_to_currency(range.begin, unit: "", delimiter: ".", separator: ",", precision: 0) %> - 
                <%= range.end == Float::INFINITY ? "trở lên" : number_to_currency(range.end, unit: "", delimiter: ".", separator: ",", precision: 0) %>:
              </span>
              <span class="text-orange-600"><%= number_to_currency(tax, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="flex justify-between items-center py-3 border-t border-green-300 bg-green-100 rounded-xl px-4">
      <span class="font-bold text-sm text-gray-800">Tổng thuế TNCN:</span>
      <span class="font-bold text-sm text-red-700"><%= number_to_currency(total_tax, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
    </div>

    <div class="flex justify-between items-center py-3 bg-blue-100 border border-blue-300 rounded-xl px-4">
      <span class="font-bold text-sm text-gray-800">Thu nhập ròng (Net):</span>
      <span class="font-bold text-sm text-blue-800"><%= number_to_currency(@gross_amount - @result.social_insurance_amount - @result.health_insurance_amount - @result.unemployment_insurance_amount - total_tax, unit: "", delimiter: ".", separator: ",", precision: 0) %> VND</span>
    </div>
  </div>
<% else %>
  <div class="bg-gray-50 border border-gray-200 rounded-xl p-6 text-center">
    <div class="text-gray-400 mb-4">
      <svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
      </svg>
    </div>
    <p class="text-gray-500">Nhập thông tin và nhấn \"Tính Thuế TNCN\" để xem kết quả</p>
  </div>
<% end %>
</div>
